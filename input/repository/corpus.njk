---
layout: base.njk
pagination:
  data: collections.corporaPages
  size: 1
  alias: corpus
permalink: "repository/{{ corpus.fileSlug | lower }}/index.{{ corpus.data.language }}.html"
---

{% if corpus.data.language == "de" %}
  {% set repoLink = "/repository.de.html" %}
{% else %}
  {% set repoLink = "/repository.en.html" %}
{% endif %}

<nav class="breadcrumbs">
  <a href="/">Home</a> &gt; 
  <a href="{{ repoLink }}">Repository</a> &gt; 
  <span>{{ corpus.title }}</span>
</nav>

<h1>{{ corpus.data.corpus_admin_name }}</h1>
<p class="corpus-description">{{ corpus.data.description }}</p>

<div class="corpus-meta-card">
  <h2>Corpus Metadata</h2>
  <table class="corpus-details">
    <tr><th>Modality</th><td>{{ corpus.data.modality }}</td></tr>
    <tr><th>Task Type</th><td>{{ corpus.data.task_type }}</td></tr>
    <tr><th>Language</th><td>{{ corpus.data.language }}</td></tr>
    <tr><th>Size in Texts</th><td>{{ corpus.data.size_texts }}</td></tr>
    <tr><th>Size in Tokens</th><td>{{ corpus.data.size_in_tokens }}</td></tr>
    <tr><th>Number of Learners</th><td>{{ corpus.data.num_learners }}</td></tr>
    <tr><th>Proficiency</th><td>{{ corpus.data.proficiency }}</td></tr>
    <tr><th>PT Stages Observed</th><td>{{ corpus.data.pt_stages_observed }}</td></tr>
    <tr><th>Access</th><td>{{ corpus.data.access }}</td></tr>
    <tr><th>Source</th><td><a href="{{ corpus.data.source }}" target="_blank">Source Project</a></td></tr>
    <tr><th>PID</th><td>
      <span class="copyable">{{ corpus.data.pid }}</span> 
      <button class="copy-btn" data-copy="{{ corpus.data.pid }}">üìã</button>
    </td></tr>
    <tr><th>Unique Handle</th><td>
      <a href="{{ corpus.data.unique_handle }}" target="_blank">View Corpus</a> 
      <button class="copy-btn" data-copy="{{ corpus.data.unique_handle }}">üìã</button>
    </td></tr>
    <tr><th>Version</th><td>{{ corpus.data.version }}</td></tr>
  </table>
</div>

<!-- ‚úÖ Hierarchical Metadata Grouping with Dropdowns -->
{% set groups = {
  "Admin Information": "corpus_admin_",
  "Design Information": "corpus_design_",
  "Proficiency Information": "corpus_proficiency_",
  "Project Information": "corpus_project_",
  "Subcorpus Info": "corpus_subcorpus_",
  "Production Setting": "productionSetting_"
} %}

{% for group, prefix in groups %}
  {% if group == "Admin Information" or group == "Design Information" %}
    <h2 class="metadata-heading">{{ group }}</h2>
    <table class="metadata-table">
      <tbody>
        {% for key, value in corpus.data %}
          {% if key.startsWith(prefix) %}
            <tr>
              <td class="meta-key">{{ key | replace(prefix, "") | replace("_", " ") }}</td>
              <td class="meta-value">
                {% if value is string %}
                  {{ value }}
                {% else %}
                  {{ value | dump }}
                {% endif %}
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <details>
      <summary><h2 class="metadata-heading">{{ group }}</h2></summary>
      <table class="metadata-table">
        <tbody>
          {% for key, value in corpus.data %}
            {% if key.startsWith(prefix) %}
              <tr>
                <td class="meta-key">{{ key | replace(prefix, "") | replace("_", " ") }}</td>
                <td class="meta-value">
                  {% if value is string %}
                    {{ value }}
                  {% else %}
                    {{ value | dump }}
                  {% endif %}
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </details>
  {% endif %}
{% endfor %}

<div class="corpus-downloads">
  <h2>Downloads</h2>
  {% set corpusFolder = corpus.data.corpus_name %}
<ul>
  {% if corpus.data.cas_data %}
    <li><a class="button" href="/data/{{ corpusFolder }}/{{ corpus.data.cas_data }}" download>CAS-data</a></li>
  {% endif %}
  {% if corpus.data.plain_text %}
    <li><a class="button" href="/data/{{ corpusFolder }}/{{ corpus.data.plain_text }}" download>Plain Text</a></li>
  {% endif %}
  {% if corpus.data.metadata_csv %}
    <li><a class="button" href="/data/{{ corpusFolder }}/{{ corpus.data.metadata_csv }}" download>Metadata (CSV)</a></li>
  {% endif %}
  {% if corpus.data.source_format %}
    <li><a class="button" href="/data/{{ corpusFolder }}/{{ corpus.data.source_format }}" download>Source Format</a></li>
  {% endif %}
</ul>
</div>

<p>
  <a href="{{ repoLink }}" class="back-link">‚Üê Back to Repository</a>
</p>

<script>
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const text = btn.dataset.copy;
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = "‚úÖ";
        setTimeout(() => btn.textContent = "üìã", 1500);
      });
    });
  });
</script>
